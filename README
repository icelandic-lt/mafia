---------------------------------------------------------------------
MAFIA (Match-Finder Aligner)
---------------------------------------------------------------------
Author: Carlos Daniel Hernández Mena
Email: carlosm@ru.is
Location: Reykjavík University, Language and Voice Lab. (LVL)

---------------------------------------------------------------------
DESCRIPTION
---------------------------------------------------------------------

MAFIA is the acronym for Match-Finder Aligner. The MAFIA aligner is
a software tool destined to automaticaly create an ASR corpora out 
of speech files along with scripts reflecting what is spoken in such
speech files. If the text of the scripts is not completely accurate,
MAFIA will infer a transcription using automatic speech recognition.

---------------------------------------------------------------------
LÝSINGU
---------------------------------------------------------------------

MAFIA stendur fyrir "Match-Finder Aligner" eða samstæðufinnandi 
raðari á íslensku. MAFIA er hannað til að búa til talgreiningargögn 
á sjálfvirkan hátt úr upptökum og handriti sem endurspeglar innihald 
upptökunnar. Ef handritið er ekki fullkomlega rétt lesið mun MAFIA 
nota talgreiningu til að finna réttan texta.

---------------------------------------------------------------------
INPUT DATA
---------------------------------------------------------------------

The speech files have to be in the format WAV at 16khz@16bit/mono.

It is expected that scripts and speech files to share a common 
root directory. Both have to have the same name but different 
extension: txt for the scripts and wav for the speech files. There 
can be any number of pairs of "script/speech files" as needed.

---------------------------------------------------------------------
RUNNING MAFIA
---------------------------------------------------------------------

1. Create a conda environment with the software requirements
   specified below.
   
2. Open the file mafia.h and identify put a path to the input data
   using the variable INPUT_DATA.
   
3. Run the MAFIA Aligner by typing:
   
	$ bash mafia.h

---------------------------------------------------------------------
REQUIREMENTS
---------------------------------------------------------------------
- You have to install in your system:

* sox
* libsndfile1
* ffmpeg.

- Create the conda environment

$ conda create -n nemo_r150 python=3.7 anaconda

- Activate the environment

$ conda activate nemo_r150

- Install Pytorch

$ conda install pytorch torchvision torchaudio cudatoolkit -c pytorch

- Install NVIVIDIA-APEX
$ git clone https://github.com/NVIDIA/apex
$ cd apex
$ pip install -v --disable-pip-version-check --no-cache-dir ./
	
- Install some packages
$ pip install wget
$ pip install unidecode

- Install NeMo

$ pip install git+https://github.com/NVIDIA/NeMo.git@r1.5.0#egg=nemo_toolkit[all]
	
- Install LM Decoders

$ git clone https://github.com/NVIDIA/NeMo.git
$ cd NeMo/scripts/asr_language_modeling/ngram_lm
$ bash install_beamsearch_decoders.sh
	
- Test Instalation

$ python
$ import nemo
$ import nemo.collections.asr as nemo_asr

- Install inaSpeechSegmenter

$ pip install inaSpeechSegmenter

- Install JIWER

$ pip install jiwer

---------------------------------------------------------------------
- Install SRILM in your system

- For compilation follo te instructions at:
http://www.speech.sri.com/projects/srilm/download.html

- After compiling add SRILM to your system PATH

- If SRILM is installed correctly, you will be able to run
  the following command in your terminal:
  
$ ngram-count -help


*** HINT: Kaldi has an installation script for SRILM at:

$ kaldi/tools/install_srilm.sh

---------------------------------------------------------------------
ACKNOWLEDGEMENTS
---------------------------------------------------------------------

This project was funded by the Language Technology Programme for 
Icelandic 2019-2023. The programme, which is managed and coordinated 
by Almannarómur, is funded by the Icelandic Ministry of Education, 
Science and Culture.

---------------------------------------------------------------------
---------------------------------------------------------------------

